---
import { getTagPage } from "../../../utils/api";

import GlobalLayout from "../../../layouts/GlobalLayout.astro";
import ExcerptList from "../../../components/ExcerptList.astro";

interface Props {
  page: any;
  tagSlug: string;
}

export async function getStaticPaths({ paginate }: any) {
  const tagObjects = await getTagPage();
  const allCategories: any[] = [];
  tagObjects.forEach((tabObject: { slug: any }) =>
    allCategories.push(tabObject.slug)
  );
  return allCategories.flatMap(tag => {
    const filteredPosts = tagObjects.find(
      (tagObject: { slug: any }) => tagObject.slug === tag
    );
    return paginate(filteredPosts.posts, {
      params: { slug: tag },
      props: { tagSlug: filteredPosts.slug },
      pageSize: Number(import.meta.env.postsPerPage),
    });
  });
}

const { page, tagSlug } = Astro.props;
---

<GlobalLayout metaTitle=`Posts tagged as ${tagSlug}`>
  <header class="mx-auto max-w-inner-sm pb-16">
    <h1 class="text-2xl">
      Posts tagged as: <span class="text-primary">#{tagSlug}</span>
    </h1>
  </header>
  <ExcerptList page={page} />
</GlobalLayout>
